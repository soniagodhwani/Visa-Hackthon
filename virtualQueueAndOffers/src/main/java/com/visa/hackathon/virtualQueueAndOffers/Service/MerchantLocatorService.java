package com.visa.hackathon.virtualQueueAndOffers.Service;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;
import java.util.UUID;

import com.visa.developer.sample.merchant_locator_api.model.MerchantLocatorpostResponse;
import com.visa.developer.sample.merchant_locator_api.model.Response;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.threeten.bp.LocalDateTime;
import org.threeten.bp.ZoneId;
import org.threeten.bp.ZonedDateTime;
import org.threeten.bp.format.DateTimeFormatter;
import org.threeten.bp.temporal.ChronoUnit;

import com.fasterxml.jackson.databind.ObjectMapper;
//import com.visa.developer.sample.merchant_locator_api.model.MerchantLocatorpostResponse;
//import com.visa.developer.sample.merchant_locator_api.model.Response;
//import com.visa.developer.sample.merchant_locator_api.model.ResponseValues;
import com.visa.hackathon.virtualQueueAndOffers.DAO.UserProfiles.MerchantDAO;
import com.visa.hackathon.virtualQueueAndOffers.Model.UserProfiles.Merchant;

@Service
public class MerchantLocatorService {

	@Autowired
	MerchantDAO merchantDAO;

	public List<Merchant> getAllMerchants(String latitude, String longitude) {
		List<String> lstResponse = new ArrayList<String>();
		String jsonPayload1 = transformPayload("{\r\n        \"response\": [\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"13.135446\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"1830 OCEAN AVE\",\r\n                    \"merchantPostalCode\": \"94112-1768\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5310\",\r\n                        \"5411\"\r\n                    ],\r\n                    \"distance\": \"0 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"DISCOUNT STORES\",\r\n                        \"GROCERY STORES SUPERMARKETS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"TARGET CORP\",\r\n                    \"primaryMerchantCategoryCode\": \"5310\",\r\n                    \"visaMerchantName\": \"TARGET\",\r\n                    \"visaStoreName\": \"TARGET\",\r\n                    \"locationAddressLatitude\": \"37.725025\",\r\n                    \"locationAddressLongitude\": \"-122.461593\",\r\n                    \"visaStoreId\": \"179653643\",\r\n                    \"visaMerchantId\": \"52014432\",\r\n                    \"merchantUrl\": [\r\n                        \"www.target.com\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3338 N TEXAS ST STE A\",\r\n                    \"merchantPostalCode\": \"94127\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.6 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"STARBUCKS CORPORATION\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"STARBUCKS\",\r\n                    \"visaStoreName\": \"STARBUCKS STORE\",\r\n                    \"locationAddressLatitude\": \"37.733599\",\r\n                    \"locationAddressLongitude\": \"-122.463756\",\r\n                    \"visaStoreId\": \"209029977\",\r\n                    \"visaMerchantId\": \"29992901\",\r\n                    \"merchantUrl\": []\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3251 20TH AVE STE 250F\",\r\n                    \"merchantPostalCode\": \"94132-1915\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.79 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"STARBUCKS CORPORATION\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"STARBUCKS\",\r\n                    \"visaStoreName\": \"STARBUCKS\",\r\n                    \"locationAddressLatitude\": \"37.727981\",\r\n                    \"locationAddressLongitude\": \"-122.475587\",\r\n                    \"visaStoreId\": \"157154375\",\r\n                    \"visaMerchantId\": \"29992901\",\r\n                    \"merchantUrl\": [\r\n                        \"www.starbucks.com\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3251 20TH AVE STE 250H\",\r\n                    \"merchantPostalCode\": \"94132-1915\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\",\r\n                        \"EC\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.79 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"PANDA MANAGEMENT GROUP\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"PANDA EXPRESS\",\r\n                    \"visaStoreName\": \"STONESTOWN PANDA EXPRESS 112\",\r\n                    \"locationAddressLatitude\": \"37.727981\",\r\n                    \"locationAddressLongitude\": \"-122.475587\",\r\n                    \"visaStoreId\": \"142989148\",\r\n                    \"visaMerchantId\": \"58000340\",\r\n                    \"merchantUrl\": [\r\n                        \"www.pandaexpress.com\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3251 20TH AVE\",\r\n                    \"merchantPostalCode\": \"94132-1900\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\",\r\n                        \"MOTO\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.79 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"WETZEL'S PRETZELS\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"WETZEL'S PRETZELS\",\r\n                    \"visaStoreName\": \"WETZEL'S PRETZELS\",\r\n                    \"locationAddressLatitude\": \"37.727981\",\r\n                    \"locationAddressLongitude\": \"-122.475587\",\r\n                    \"visaStoreId\": \"165609714\",\r\n                    \"visaMerchantId\": \"32732413\",\r\n                    \"merchantUrl\": [\r\n                        \"www.wetzels.com\"\r\n                    ]\r\n                }\r\n            }\r\n        ],\r\n        \"header\": {\r\n            \"startIndex\": \"0\",\r\n            \"numRecordsMatched\": 16,\r\n            \"numRecordsReturned\": 5,\r\n            \"requestMessageId\": \"Request_001\",\r\n            \"messageDateTime\": \"2020-06-30T16:34:06.736\",\r\n            \"responseMessageId\": \"68VDP3202620200630163406736\",\r\n            \"endIndex\": \"4\"\r\n        },\r\n        \"status\": {\r\n            \"statusDescription\": \"Success\",\r\n            \"statusCode\": \"CDI000\"\r\n        }\r\n    }");
        String jsonPayload2 = transformPayload("{\r\n        \"response\": [\r\n            {\r\n                \"responseValues\": {\r\n                    \"visaMerchantName\": \"WETZEL'S PRETZELS\",\r\n                    \"visaStoreName\": \"WETZEL'S PRETZELS\",\r\n                    \"locationAddressLatitude\": \"37.727981\",\r\n                    \"locationAddressLongitude\": \"-122.475587\",\r\n                    \"visaStoreId\": \"165609714\",\r\n                    \"visaMerchantId\": \"32732413\",\r\n                    \"merchantUrl\": [\r\n                        \"www.wetzels.com\"\r\n                    ],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"WETZEL'S PRETZELS\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3251 20TH AVE\",\r\n                    \"merchantPostalCode\": \"94132-1900\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\",\r\n                        \"MOTO\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.79 m\"\r\n                },\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\"\r\n            },\r\n            {\r\n                \"responseValues\": {\r\n                    \"visaMerchantName\": \"KWIK TRIP\",\r\n                    \"visaStoreName\": \"KWIK &amp; CONVENIENT\",\r\n                    \"locationAddressLatitude\": \"37.731575\",\r\n                    \"locationAddressLongitude\": \"-122.448866\",\r\n                    \"visaStoreId\": \"151607473\",\r\n                    \"visaMerchantId\": \"22225664\",\r\n                    \"merchantUrl\": [\r\n                        \"www.quick-e-recipes.com\"\r\n                    ],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"MISC FOOD STORES - DEFAULT\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"KWIK TRIP\",\r\n                    \"primaryMerchantCategoryCode\": \"5499\",\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"600 MONTEREY BLVD\",\r\n                    \"merchantPostalCode\": \"94127-2347\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\",\r\n                        \"MOTO\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5499\"\r\n                    ],\r\n                    \"distance\": \"0.83 m\"\r\n                },\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"7.343712\"\r\n            },\r\n            {\r\n                \"responseValues\": {\r\n                    \"visaMerchantName\": \"STARBUCKS\",\r\n                    \"visaStoreName\": \"STARBUCKS\",\r\n                    \"locationAddressLatitude\": \"37.739236\",\r\n                    \"locationAddressLongitude\": \"-122.467674\",\r\n                    \"visaStoreId\": \"159339773\",\r\n                    \"visaMerchantId\": \"29992901\",\r\n                    \"merchantUrl\": [\r\n                        \"www.starbucks.com\"\r\n                    ],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"STARBUCKS CORPORATION\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"100 WEST PORTAL AVE\",\r\n                    \"merchantPostalCode\": \"94127-1306\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"1.04 m\"\r\n                },\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\"\r\n            },\r\n            {\r\n                \"responseValues\": {\r\n                    \"visaMerchantName\": \"POPEYES CHICKEN\",\r\n                    \"visaStoreName\": \"POPEYES CHICKEN &amp; BISCUITS\",\r\n                    \"locationAddressLatitude\": \"37.716634\",\r\n                    \"locationAddressLongitude\": \"-122.441201\",\r\n                    \"visaStoreId\": \"191521290\",\r\n                    \"visaMerchantId\": \"26909705\",\r\n                    \"merchantUrl\": [\r\n                        \"www.popeyes.com\"\r\n                    ],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"POPEYES LOUISIANA KITCHEN\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"890 GENEVA AVE\",\r\n                    \"merchantPostalCode\": \"94112-3329\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In more than 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"1.26 m\"\r\n                },\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\"\r\n            },\r\n            {\r\n                \"responseValues\": {\r\n                    \"visaMerchantName\": \"GENEVA SNACK ST\",\r\n                    \"visaStoreName\": \"GENEVA SNACK STORE\",\r\n                    \"locationAddressLatitude\": \"37.716352\",\r\n                    \"locationAddressLongitude\": \"-122.440895\",\r\n                    \"visaStoreId\": \"132031479\",\r\n                    \"visaMerchantId\": \"72947573\",\r\n                    \"merchantUrl\": [],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"GROCERY STORES SUPERMARKETS\",\r\n                        \"VARIETY STORES\",\r\n                        \"MISC FOOD STORES - DEFAULT\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"GENEVA SNACK STORE\",\r\n                    \"primaryMerchantCategoryCode\": \"\",\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"901 GENEVA AVE\",\r\n                    \"merchantPostalCode\": \"94112-3402\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5411\",\r\n                        \"5331\",\r\n                        \"5499\"\r\n                    ],\r\n                    \"distance\": \"1.28 m\"\r\n                },\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"7.827176\"\r\n            }\r\n        ],\r\n        \"header\": {\r\n            \"startIndex\": \"5\",\r\n            \"numRecordsMatched\": 16,\r\n            \"numRecordsReturned\": 5,\r\n            \"requestMessageId\": \"Request_001\",\r\n            \"messageDateTime\": \"2020-06-30T16:37:30.947\",\r\n            \"responseMessageId\": \"68VDP7074020200630163730947\",\r\n            \"endIndex\": \"9\"\r\n        },\r\n        \"status\": {\r\n            \"statusDescription\": \"Success\",\r\n            \"statusCode\": \"CDI000\"\r\n        }\r\n    }");
        String jsonPayload3 = transformPayload("{\r\n        \"response\": [\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"8.735601\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"555 TARAVAL ST\",\r\n                    \"merchantPostalCode\": \"94116-2511\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5411\"\r\n                    ],\r\n                    \"distance\": \"1.38 m\",\r\n                    \"visaMerchantName\": \"PARKSIDE FARMERS MARKET\",\r\n                    \"visaStoreName\": \"PARKSIDE FARMERS MARKE\",\r\n                    \"locationAddressLatitude\": \"37.743233\",\r\n                    \"locationAddressLongitude\": \"-122.472034\",\r\n                    \"visaStoreId\": \"148579129\",\r\n                    \"visaMerchantId\": \"36137288\",\r\n                    \"merchantUrl\": [\r\n                        \"www.parksidefarmersmarket.com\"\r\n                    ],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"GROCERY STORESSUPERMARKETS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"PARKSIDE FARMER'S MARKET\",\r\n                    \"primaryMerchantCategoryCode\": \"5411\"\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"11.151804\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"4550 MISSION ST\",\r\n                    \"merchantPostalCode\": \"94112-2622\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\",\r\n                        \"MOTO\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5310\",\r\n                        \"5499\",\r\n                        \"5999\"\r\n                    ],\r\n                    \"distance\": \"1.48 m\",\r\n                    \"visaMerchantName\": \"ONE DOLLAR ONLY\",\r\n                    \"visaStoreName\": \"ONE DOLLAR ONLY\",\r\n                    \"locationAddressLatitude\": \"37.724925\",\r\n                    \"locationAddressLongitude\": \"-122.434585\",\r\n                    \"visaStoreId\": \"120257209\",\r\n                    \"visaMerchantId\": \"25718249\",\r\n                    \"merchantUrl\": [],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"DISCOUNT STORES\",\r\n                        \"MISC FOOD STORES - DEFAULT\",\r\n                        \"MISC SPECIALTY RETAIL\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"ONE DOLLAR ONLY\",\r\n                    \"primaryMerchantCategoryCode\": \"5999\"\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"3.2696044\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"1101 TARAVAL ST\",\r\n                    \"merchantPostalCode\": \"94116-2441\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In more than 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5462\",\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"1.53 m\",\r\n                    \"visaMerchantName\": \"FRENCH BAKERY\",\r\n                    \"visaStoreName\": \"FRENCH BAKERY INC\",\r\n                    \"locationAddressLatitude\": \"37.742982\",\r\n                    \"locationAddressLongitude\": \"-122.477831\",\r\n                    \"visaStoreId\": \"154653437\",\r\n                    \"visaMerchantId\": \"18511505\",\r\n                    \"merchantUrl\": [],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"BAKERIES\",\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"THE FRENCH BAKERY\",\r\n                    \"primaryMerchantCategoryCode\": \"5462\"\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"9.071699\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"301 ROLPH ST\",\r\n                    \"merchantPostalCode\": \"94112-4405\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5499\",\r\n                        \"5411\",\r\n                        \"5921\"\r\n                    ],\r\n                    \"distance\": \"1.58 m\",\r\n                    \"visaMerchantName\": \"CORDOVA MARKET\",\r\n                    \"visaStoreName\": \"CORDOVA MARKET\",\r\n                    \"locationAddressLatitude\": \"37.713521\",\r\n                    \"locationAddressLongitude\": \"-122.436667\",\r\n                    \"visaStoreId\": \"215239680\",\r\n                    \"visaMerchantId\": \"35217159\",\r\n                    \"merchantUrl\": [],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"MISC FOOD STORES - DEFAULT\",\r\n                        \"GROCERY STORESSUPERMARKETS\",\r\n                        \"PKG STORESBEERWINELIQUOR\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"HISHAM J ZUMAT\",\r\n                    \"primaryMerchantCategoryCode\": \"\"\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"1523 SLOAT BLVD\",\r\n                    \"merchantPostalCode\": \"94132-1222\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"1.65 m\",\r\n                    \"visaMerchantName\": \"CHIPOTLE MEXICAN GRILL\",\r\n                    \"visaStoreName\": \"CHIPOTLE MEXICAN GRILL\",\r\n                    \"locationAddressLatitude\": \"37.734037\",\r\n                    \"locationAddressLongitude\": \"-122.489569\",\r\n                    \"visaStoreId\": \"143244925\",\r\n                    \"visaMerchantId\": \"14837334\",\r\n                    \"merchantUrl\": [\r\n                        \"www.chipotle.com\"\r\n                    ],\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"CHIPOTLE MEXICAN GRILL\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\"\r\n                }\r\n            }\r\n        ],\r\n        \"header\": {\r\n            \"startIndex\": \"11\",\r\n            \"numRecordsMatched\": 16,\r\n            \"numRecordsReturned\": 5,\r\n            \"requestMessageId\": \"Request_001\",\r\n            \"messageDateTime\": \"2020-06-30T16:39:35.657\",\r\n            \"responseMessageId\": \"68VDP2805620200630163935657\",\r\n            \"endIndex\": \"15\"\r\n        },\r\n        \"status\": {\r\n            \"statusDescription\": \"Success\",\r\n            \"statusCode\": \"CDI000\"\r\n        }\r\n    }");
        List<String> lstPayload = new ArrayList<String>();
		List<Merchant> lstMerchants = new ArrayList<Merchant>();
        lstPayload.add(jsonPayload1);
        lstPayload.add(jsonPayload2);
        lstPayload.add(jsonPayload3);
        for(String json: lstPayload){

			ObjectMapper objectMapper = new ObjectMapper();
			try {
				MerchantLocatorpostResponse merchantLocatorpostResponse = objectMapper.readValue(json, MerchantLocatorpostResponse.class);
				if(merchantLocatorpostResponse!=null && !merchantLocatorpostResponse.getResponse().isEmpty()){
					addToMerchantList(merchantLocatorpostResponse, lstMerchants);
				}
			} catch (IOException e) {
				e.printStackTrace();
				return lstMerchants;
			}
        }
		return lstMerchants;
	}

	public Float getMerchantAvgWaitTime(String visaStoreId){
		Merchant merchantData = merchantDAO.findByVisaStoreId(visaStoreId);
		if(merchantData==null)
			return null;
		else
			return merchantData.getAvgCustomerWaitTime();
	}

	public void addToMerchantList(MerchantLocatorpostResponse merchantLocatorpostResponse, List<Merchant> lstMerchants){
		for(Response resp: merchantLocatorpostResponse.getResponse()){
			Merchant merchant = new Merchant();
			merchant.setMerchantName(resp.getResponseValues().getVisaMerchantName());
			merchant.setVisaMerchantId(resp.getResponseValues().getVisaMerchantId());
			merchant.setLatitude(resp.getResponseValues().getLocationAddressLatitude());
			merchant.setLongitude(resp.getResponseValues().getLocationAddressLongitude());
			merchant.setVisaStoreId(resp.getResponseValues().getVisaStoreId());
			merchant.setAvgCustomerWaitTime(getMerchantAvgWaitTime(merchant.getVisaStoreId()));
			lstMerchants.add(merchant);
		}

	}

	public List<Merchant> getMerchantsByDistance(String latitude, String longitude, long distance) {
		List<String> lstResponse = new ArrayList<String>();
		String jsonString="{\r\n        \"response\": [\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"13.135446\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"1830 OCEAN AVE\",\r\n                    \"merchantPostalCode\": \"94112-1768\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5310\",\r\n                        \"5411\"\r\n                    ],\r\n                    \"distance\": \"0 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"DISCOUNT STORES\",\r\n                        \"GROCERY STORESSUPERMARKETS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"TARGET CORP\",\r\n                    \"primaryMerchantCategoryCode\": \"5310\",\r\n                    \"visaMerchantName\": \"TARGET\",\r\n                    \"visaStoreName\": \"TARGET\",\r\n                    \"locationAddressLatitude\": \"37.725025\",\r\n                    \"locationAddressLongitude\": \"-122.461593\",\r\n                    \"visaStoreId\": \"179653643\",\r\n                    \"visaMerchantId\": \"52014432\",\r\n                    \"merchantUrl\": [\r\n                        \"www.target.com\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3338 N TEXAS ST STE A\",\r\n                    \"merchantPostalCode\": \"94127\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.6 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"STARBUCKS CORPORATION\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"STARBUCKS\",\r\n                    \"visaStoreName\": \"STARBUCKS STORE\",\r\n                    \"locationAddressLatitude\": \"37.733599\",\r\n                    \"locationAddressLongitude\": \"-122.463756\",\r\n                    \"visaStoreId\": \"209029977\",\r\n                    \"visaMerchantId\": \"29992901\",\r\n                    \"merchantUrl\": []\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3251 20TH AVE STE 250F\",\r\n                    \"merchantPostalCode\": \"94132-1915\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\",\r\n                        \"PAYWAVE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.79 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"STARBUCKS CORPORATION\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"STARBUCKS\",\r\n                    \"visaStoreName\": \"STARBUCKS\",\r\n                    \"locationAddressLatitude\": \"37.727981\",\r\n                    \"locationAddressLongitude\": \"-122.475587\",\r\n                    \"visaStoreId\": \"157154375\",\r\n                    \"visaMerchantId\": \"29992901\",\r\n                    \"merchantUrl\": [\r\n                        \"www.starbucks.com\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3251 20TH AVE STE 250H\",\r\n                    \"merchantPostalCode\": \"94132-1915\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\",\r\n                        \"EC\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.79 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"PANDA MANAGEMENT GROUP\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"PANDA EXPRESS\",\r\n                    \"visaStoreName\": \"STONESTOWN PANDA EXPRESS 112\",\r\n                    \"locationAddressLatitude\": \"37.727981\",\r\n                    \"locationAddressLongitude\": \"-122.475587\",\r\n                    \"visaStoreId\": \"142989148\",\r\n                    \"visaMerchantId\": \"58000340\",\r\n                    \"merchantUrl\": [\r\n                        \"www.pandaexpress.com\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"matchIndicators\": {\r\n                    \"merchantCountryCode\": \"Y\",\r\n                    \"merchantCategoryCode\": \"Y\"\r\n                },\r\n                \"matchScore\": \"5.025483\",\r\n                \"responseValues\": {\r\n                    \"merchantCountryCode\": \"840\",\r\n                    \"merchantStreetAddress\": \"3251 20TH AVE\",\r\n                    \"merchantPostalCode\": \"94132-1900\",\r\n                    \"merchantState\": \"CA\",\r\n                    \"merchantCity\": \"SAN FRANCISCO\",\r\n                    \"paymentAcceptanceMethod\": [\r\n                        \"F2F\",\r\n                        \"MOTO\"\r\n                    ],\r\n                    \"terminalType\": [\r\n                        \"SWIPE\",\r\n                        \"CHIP\"\r\n                    ],\r\n                    \"firstTranDateRange\": \"In more than 365 days\",\r\n                    \"lastTranDateRange\": \"In last 365 days\",\r\n                    \"merchantCategoryCode\": [\r\n                        \"5814\"\r\n                    ],\r\n                    \"distance\": \"0.79 m\",\r\n                    \"merchantCategoryCodeDesc\": [\r\n                        \"FAST FOOD RESTAURANTS\"\r\n                    ],\r\n                    \"visaEnterpriseName\": \"WETZEL'S PRETZELS\",\r\n                    \"primaryMerchantCategoryCode\": \"5814\",\r\n                    \"visaMerchantName\": \"WETZEL'S PRETZELS\",\r\n                    \"visaStoreName\": \"WETZEL'S PRETZELS\",\r\n                    \"locationAddressLatitude\": \"37.727981\",\r\n                    \"locationAddressLongitude\": \"-122.475587\",\r\n                    \"visaStoreId\": \"165609714\",\r\n                    \"visaMerchantId\": \"32732413\",\r\n                    \"merchantUrl\": [\r\n                        \"www.wetzels.com\"\r\n                    ]\r\n                }\r\n            }\r\n        ],\r\n        \"header\": {\r\n            \"startIndex\": \"0\",\r\n            \"numRecordsMatched\": 6,\r\n            \"numRecordsReturned\": 5,\r\n            \"requestMessageId\": \"Request_001\",\r\n            \"messageDateTime\": \"2020-06-30T16:47:32.414\",\r\n            \"responseMessageId\": \"68VDP1974020200630164732414\",\r\n            \"endIndex\": \"4\"\r\n        },\r\n        \"status\": {\r\n            \"statusDescription\": \"Success\",\r\n            \"statusCode\": \"CDI000\"\r\n        }}";

		List<Merchant> lstMerchants = new ArrayList<Merchant>();
		ObjectMapper objectMapper = new ObjectMapper();

		try {
			MerchantLocatorpostResponse merchantLocatorpostResponse = objectMapper.readValue(jsonString, MerchantLocatorpostResponse.class);
			if(!merchantLocatorpostResponse.getResponse().isEmpty()){
				addToMerchantList(merchantLocatorpostResponse, lstMerchants);
			}
		} catch (IOException e) {
			e.printStackTrace();
			return lstMerchants;
		}
		return lstMerchants;
	}

	public List<Merchant> getMerchantsByCategory(String latitude, String longitude, List<String> category) {
		List<String> lstResponse = new ArrayList<String>();
		String jsonString="{\"response\":[{\"responseValues\":{\"visaMerchantName\":\"TARGET\",\"visaStoreName\":\"TARGET\",\"locationAddressLatitude\":\"37.725025\",\"locationAddressLongitude\":\"-122.461593\",\"visaStoreId\":\"179653643\",\"visaMerchantId\":\"52014432\",\"merchantUrl\":[\"www.target.com\"],\"merchantCategoryCodeDesc\":[\"DISCOUNT STORES\",\"GROCERY STORESUPERMARKETS\"],\"visaEnterpriseName\":\"TARGET CORP\",\"primaryMerchantCategoryCode\":\"5310\",\"merchantCountryCode\":\"840\",\"merchantStreetAddress\":\"1830 OCEAN AVE\",\"merchantPostalCode\":\"94112-1768\",\"merchantState\":\"CA\",\"merchantCity\":\"SAN FRANCISCO\",\"paymentAcceptanceMethod\":[\"F2F\"],\"terminalType\":[\"SWIPE\",\"CHIP\",\"PAYWAVE\"],\"firstTranDateRange\":\"In more than 365 days\",\"lastTranDateRange\":\"In last 365 days\",\"merchantCategoryCode\":[\"5310\",\"5411\"],\"distance\":\"0 m\"},\"matchIndicators\":{\"merchantCountryCode\":\"Y\",\"merchantCategoryCode\":\"Y\"},\"matchScore\":\"2.9876978\"},{\"responseValues\":{\"visaMerchantName\":\"GENEVA SNACK ST\",\"visaStoreName\":\"GENEVA SNACK STORE\",\"locationAddressLatitude\":\"37.716352\",\"locationAddressLongitude\":\"-122.440895\",\"visaStoreId\":\"132031479\",\"visaMerchantId\":\"72947573\",\"merchantUrl\":[],\"merchantCategoryCodeDesc\":[\"GROCERY STORES SUPERMARKETS\",\"VARIETY STORES\",\"MISC FOOD STORES - DEFAULT\"],\"visaEnterpriseName\":\"GENEVA SNACK STORE\",\"primaryMerchantCategoryCode\":\"\",\"merchantCountryCode\":\"840\",\"merchantStreetAddress\":\"901 GENEVA AVE\",\"merchantPostalCode\":\"94112-3402\",\"merchantState\":\"CA\",\"merchantCity\":\"SAN FRANCISCO\",\"paymentAcceptanceMethod\":[\"F2F\"],\"terminalType\":[\"SWIPE\",\"CHIP\",\"PAYWAVE\"],\"firstTranDateRange\":\"In more than 365 days\",\"lastTranDateRange\":\"In last 365 days\",\"merchantCategoryCode\":[\"5411\",\"5331\",\"5499\"],\"distance\":\"1.28 m\"},\"matchIndicators\":{\"merchantCountryCode\":\"Y\",\"merchantCategoryCode\":\"Y\"},\"matchScore\":\"4.28924\"},{\"responseValues\":{\"visaMerchantName\":\"PARKSIDE FARMERS MARKET\",\"visaStoreName\":\"PARKSIDE FARMERS MARKE\",\"locationAddressLatitude\":\"37.743233\",\"locationAddressLongitude\":\"-122.472034\",\"visaStoreId\":\"148579129\",\"visaMerchantId\":\"36137288\",\"merchantUrl\":[\"www.parksidefarmersmarket.com\"],\"merchantCategoryCodeDesc\":[\"GROCERY STORES SUPERMARKETS\"],\"visaEnterpriseName\":\"PARKSIDE FARMER'S MARKET\",\"primaryMerchantCategoryCode\":\"5411\",\"merchantCountryCode\":\"840\",\"merchantStreetAddress\":\"555 TARAVAL ST\",\"merchantPostalCode\":\"94116-2511\",\"merchantState\":\"CA\",\"merchantCity\":\"SAN FRANCISCO\",\"paymentAcceptanceMethod\":[\"F2F\"],\"terminalType\":[\"SWIPE\",\"CHIP\",\"PAYWAVE\"],\"firstTranDateRange\":\"In more than 365 days\",\"lastTranDateRange\":\"In last 365 days\",\"merchantCategoryCode\":[\"5411\"],\"distance\":\"1.38 m\"},\"matchIndicators\":{\"merchantCountryCode\":\"Y\",\"merchantCategoryCode\":\"Y\"},\"matchScore\":\"8.735601\"},{\"responseValues\":{\"visaMerchantName\":\"CORDOVA MARKET\",\"visaStoreName\":\"CORDOVA MARKET\",\"locationAddressLatitude\":\"37.713521\",\"locationAddressLongitude\":\"-122.436667\",\"visaStoreId\":\"215239680\",\"visaMerchantId\":\"35217159\",\"merchantUrl\":[],\"merchantCategoryCodeDesc\":[\"MISC FOOD STORES - DEFAULT\",\"GROCERY STORES SUPERMARKETS\",\"PKG STORES BEER WINE LIQUOR\"],\"visaEnterpriseName\":\"HISHAM J ZUMAT\",\"primaryMerchantCategoryCode\":\"\",\"merchantCountryCode\":\"840\",\"merchantStreetAddress\":\"301 ROLPH ST\",\"merchantPostalCode\":\"94112-4405\",\"merchantState\":\"CA\",\"merchantCity\":\"SAN FRANCISCO\",\"paymentAcceptanceMethod\":[\"F2F\"],\"terminalType\":[\"SWIPE\",\"CHIP\",\"PAYWAVE\"],\"firstTranDateRange\":\"In more than 365 days\",\"lastTranDateRange\":\"In last 365 days\",\"merchantCategoryCode\":[\"5499\",\"5411\",\"5921\"],\"distance\":\"1.58 m\"},\"matchIndicators\":{\"merchantCountryCode\":\"Y\",\"merchantCategoryCode\":\"Y\"},\"matchScore\":\"4.9615893\"},{\"responseValues\":{\"visaMerchantName\":\"KERY MARKET\",\"visaStoreName\":\"KERY MARKET\",\"locationAddressLatitude\":\"37.735639\",\"locationAddressLongitude\":\"-122.416763\",\"visaStoreId\":\"120255973\",\"visaMerchantId\":\"21844071\",\"merchantUrl\":[],\"merchantCategoryCodeDesc\":[\"PKG STORES BEER WINE LIQUOR\",\"GROCERY STORES SUPERMARKETS\"],\"visaEnterpriseName\":\"KERY MARKET\",\"primaryMerchantCategoryCode\":\"5921\",\"merchantCountryCode\":\"840\",\"merchantStreetAddress\":\"648 ANDOVER ST\",\"merchantPostalCode\":\"94110-6016\",\"merchantState\":\"CA\",\"merchantCity\":\"SAN FRANCISCO\",\"paymentAcceptanceMethod\":[\"F2F\"],\"terminalType\":[\"SWIPE\",\"CHIP\",\"PAYWAVE\"],\"firstTranDateRange\":\"In more than 365 days\",\"lastTranDateRange\":\"In last 365 days\",\"merchantCategoryCode\":[\"5921\",\"5411\"],\"distance\":\"2.56 m\"},\"matchIndicators\":{\"merchantCountryCode\":\"Y\",\"merchantCategoryCode\":\"Y\"},\"matchScore\":\"5.6671953\"}],\"header\":{\"startIndex\":\"0\",\"numRecordsMatched\":33,\"numRecordsReturned\":5,\"requestMessageId\":\"Request_001\",\"messageDateTime\":\"2020-06-29T20:49:49.086\",\"responseMessageId\":\"68VDP9622420200629204949086\",\"endIndex\":\"4\"},\"status\":{\"statusDescription\":\"Success\",\"statusCode\":\"CDI000\"}}";

		List<Merchant> lstMerchants = new ArrayList<Merchant>();
		ObjectMapper objectMapper = new ObjectMapper();

		try {
			MerchantLocatorpostResponse merchantLocatorpostResponse = objectMapper.readValue(jsonString, MerchantLocatorpostResponse.class);
			if(!merchantLocatorpostResponse.getResponse().isEmpty()){
				addToMerchantList(merchantLocatorpostResponse, lstMerchants);
			}
		} catch (IOException e) {
			e.printStackTrace();
			return lstMerchants;
		}
		return lstMerchants;
	}

	  public String transformPayload(String payload){
	        payload = editLocalTime(payload);
	        payload = addRandomValue(payload);
	        return payload;
	    }

	    public String editLocalTime(String payload){
	        ZoneId zoneId = ZoneId.of("America/Los_Angeles");
	        LocalDateTime localDateTime = LocalDateTime.now().truncatedTo(ChronoUnit.SECONDS);
	        ZonedDateTime laDateTime = ZonedDateTime.of(localDateTime,zoneId);
	        payload = payload.replaceAll("\"localTransactionDateTime\":\\s+\".{19}\"",
	                    "\"localTransactionDateTime\": \""+DateTimeFormatter.ISO_LOCAL_DATE_TIME.format(laDateTime)+"\"");
	        payload = payload.replaceAll("\"dateTimeLocal\":\\s+\".{10}\"",
	                    "\"dateTimeLocal\": \""+DateTimeFormatter.ofPattern("MMddHHmmss").format(laDateTime)+"\"");
	        return payload;
	    }

	    public String addRandomValue(String payload){
	        String randomAlphaNumericValue = UUID.randomUUID().toString().replaceAll("-","").substring(0,8);
	        Random rand = new Random();
	        Integer randomNumber = rand.nextInt(90000) + 10000;
	        payload = payload.replaceAll("random_string", randomAlphaNumericValue);
	        payload = payload.replaceAll("random_integer", randomNumber.toString());
	        payload = payload.replaceAll("random", randomAlphaNumericValue);
	        return payload;
	    }
}
